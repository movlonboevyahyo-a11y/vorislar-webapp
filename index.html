<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vorislar â€“ Milliy sertifikat</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }

    h1 { color: #38bdf8; }
    h3 { color: #7dd3fc; margin-top: 0; }

    .card {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: #020617;
      color: #e5e7eb;
      margin-bottom: 10px;
    }

    button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: #38bdf8;
      color: #020617;
      font-weight: bold;
      cursor: pointer;
    }

    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      background: #020617;
      border-top: 1px solid #1e293b;
    }

    .nav button {
      flex: 1;
      background: none;
      color: #e5e7eb;
    }

    .nav button.active {
      background: #0f172a;
      color: #38bdf8;
    }

    .green { color: #22c55e; }
    .yellow { color: #facc15; }
  </style>
</head>

<body>

<h1>ğŸ“˜ Vorislar</h1>

<div class="card">
  <p id="user">Foydalanuvchi: â€”</p>
  <p>â­ Ball: <b id="ball">0</b></p>
</div>

<div id="content"></div>

<div class="nav">
  <button id="nav-lugat" class="active" onclick="openPage('lugat')">ğŸ“˜ Lugâ€˜at</button>
  <button id="nav-test" onclick="openPage('test')">ğŸ“ Test</button>
  <button id="nav-essay" onclick="openPage('essay')">âœï¸ Essay</button>
  <button id="nav-profil" onclick="openPage('profil')">ğŸ‘¤ Profil</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();

  const saved = JSON.parse(localStorage.getItem("vorislar_state")) || {
    ball: 0,
    essays: 0,
    tests: 0
  };

  let state = saved;

  if (tg.initDataUnsafe?.user) {
    document.getElementById("user").innerText =
      "Foydalanuvchi: " + tg.initDataUnsafe.user.first_name;
  }

  function saveState() {
    localStorage.setItem("vorislar_state", JSON.stringify(state));
    document.getElementById("ball").innerText = state.ball;
  }

  saveState();

  function openPage(page) {
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    document.getElementById("nav-" + page).classList.add("active");

    const content = document.getElementById("content");

    /* LUGâ€˜AT */
    if (page === "lugat") {
      content.innerHTML = `
        <div class="card">
          <h3>ğŸ“˜ Lugâ€˜at</h3>
          <input id="word" placeholder="Soâ€˜z kiriting...">
          <button onclick="searchWord()">Qidirish</button>
          <div id="result"></div>
        </div>
      `;
    }

    /* TEST (sen keyin toâ€˜ldirasan) */
    if (page === "test") {
      content.innerHTML = `
        <div class="card">
          <h3>ğŸ“ Test</h3>
          <p>Bu boâ€˜limni sen real testlar bilan toâ€˜ldirasan.</p>
          <p class="yellow">Ball test savollariga qarab beriladi.</p>
        </div>
      `;
    }

    /* ESSAY */
    if (page === "essay") {
      content.innerHTML = `
        <div class="card">
          <h3>âœï¸ Essay</h3>
          <textarea id="essayText" rows="6" placeholder="Essay yozing..."></textarea>
          <button onclick="submitEssay()">Essay topshirish</button>
          <div id="essayResult"></div>
        </div>
      `;
    }

    /* PROFIL */
    if (page === "profil") {
      let premium =
        state.ball >= 100 ? "40%" :
        state.ball >= 60  ? "20%" :
        state.ball >= 30  ? "10%" :
        "0%";

      content.innerHTML = `
        <div class="card">
          <h3>ğŸ‘¤ Profil</h3>
          <p>Ball: <b>${state.ball}</b></p>
          <p>Essaylar: ${state.essays}</p>
          <p>Testlar: ${state.tests}</p>
          <p class="yellow">Premium: ${premium}</p>
        </div>
      `;
    }
  }

  function searchWord() {
    const word = document.getElementById("word").value.trim();
    const result = document.getElementById("result");
    if (!word) {
      result.innerHTML = "<p>â— Soâ€˜z kiriting</p>";
      return;
    }
    result.innerHTML = `
      <p><b>Soâ€˜z:</b> ${word}</p>
      <p><b>Maâ€™nosi:</b> Namuna (keyin API ulanadi)</p>
    `;
  }

  function submitEssay() {
    const text = document.getElementById("essayText").value.trim();
    const res = document.getElementById("essayResult");

    if (text.length < 50) {
      res.innerHTML = "<p>â— Essay juda qisqa</p>";
      return;
    }

    let earned = text.length >= 300 ? 20 : text.length >= 150 ? 15 : 10;

    state.ball += earned;
    state.essays += 1;
    saveState();

    res.innerHTML = `<p class="green">Essay qabul qilindi. +${earned} ball</p>`;
  }

  openPage("lugat");
</script>

</body>
</html>
